# Specific config (symlinked configfile)
source ~/.mutt/specific_config

# Accounts
source ~/.mutt/accounts/whi-cred

# PGP
source ~/.mutt/crypto

# Settings
set header_cache      = ~/.mutt/cache/headers
set message_cachedir  = ~/.mutt/cache/bodies
set certificate_file  = ~/.mutt/certificates
set sendmail_wait     = 0                                                      # wait for sending to finish
set quit                                                                       # no confirm quitting
unset move                                                                     # no confirm moving messages
unset confirmappend                                                            # no confirm moving messages
set delete            = yes                                                    # auto purge
unset record                                                                   # gmail automatically stores sent items
set include                                                                    # include original message in reply
set sort              = 'reverse-threads'
set sort_aux          = 'last-date-received'
set auto_tag                                                                   # do not require tag prefix when having tagged messages
set sig_dashes        = no
set sig_on_top
set fast_reply                                                                 # skip prompts
set reply_to                                                                   # use this header
set pager_index_lines = 15
set to_chars          = ' +>-<L'
unset beep
unset resolve                                                                  # do not move cursor to next message
set menu_scroll                                                                # do not clear screen with large menus
set tilde                                                                      # vim tilde behaviour
unset markers                                                                  # hide + prefix in pager
ignore "Authentication-Results:"
ignore "DomainKey-Signature:"
ignore "DKIM-Signature:"
hdr_order Date From To Cc
alternative_order text/plain text/html *
auto_view text/html
ignore *
unignore From: To: Date: Subject:

# Key bindings
bind  index gg    first-entry
bind  index G     last-entry
bind  index <tab> sync-mailbox
bind  index N     search-opposite
bind  pager N     search-opposite
bind  index B     bounce-message
macro index \Cr   "T~U<enter><tag-prefix><clear-flag>N<untag-pattern>.<enter>" "Mark all messages as read"

# Gmail-style key bindings
bind  index,pager a  group-reply
bind  index,pager s  flag-message
bind  index,pager \# delete-thread
#bind  index,pager l  copy-message
macro index,pager I  <clear-flag>O                                              "Mark as read"
macro index,pager U  <set-flag>O                                                "Mark as unread"

# Sync contacts: needs goobook, ~/.goobookrc
set query_command    = "goobook query '%s'"
bind  editor <tab>   complete-query
macro index  gA      "<pipe-message>goobook add<return>"                        "Add sender to google contacts"
macro pager  gA      "<pipe-message>goobook add<return>"                        "Add sender to google contacts"

# Sidebar
set sidebar_width   = 25
set sidebar_visible = yes
set sidebar_delim   = '|'
set sidebar_sort    = yes
color sidebar_new   yellow default
bind  index,pager   <down>  sidebar-next
bind  index,pager   <up>    sidebar-prev
bind  index,pager   <right> sidebar-open
macro index,pager   b       "<enter-command>toggle sidebar_visible<enter>"     "Toggle sidebar"

# Urlview
macro pager  \Cu   <pipe-entry>'urlview'<enter> 'Follow links with urlview'

# Attachment path prefix
macro attach s     <save-entry><bol>~/down/<eol>                          "Save attachment to Downloads folder"

# Theme: https://github.com/altercation/mutt-colors-solarized
source ~/.mutt/mutt-colors-solarized/mutt-colors-solarized-dark-16.muttrc

# Free text search.
macro index <F8> \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<shell-escape>notmuch-mutt -r --prompt search<enter>\
<change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
"notmuch: search mail"
